<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header.html :: header"></head>
<body>
<nav th:replace="fragments/navbar.html :: user">
</nav>
<form class="container" id="postingForm" th:action="@{/post}" th:object="${postForm}" method="post" novalidate>
    <div class="row justify-content-center">
        <div class="col-6 row row-cols-auto mt-5 mb-5">
            <h3>글쓰기</h3>
        </div>
    </div>
    <div class="row justify-content-center mb-5">
        <div class="col-3">
            <div th:if="${errors}" class="alert alert-danger" role="alert">
                잘못 입력했습니다.
            </div>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="mb-3 col-6">
            <div class="form-floating">
                <input type="text" class="form-control" th:field="*{nickname}" id="nickName" placeholder="닉네임을 입력하세요">
                <label for="nickName">닉네임</label>
                <div class="invalid-feedback">
                    공란일 수 없다.
                </div>
            </div>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="mb-3 col-6">
            <div class="form-floating">
                <input type="text" class="form-control" th:field="*{title}" id="title" placeholder="글의 제목을 입력하세요">
                <label for="title">제목</label>
                <div class="invalid-feedback">
                    공란일 수 없다.
                </div>
            </div>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="mb-3 col-6 ">
            <div class="form-floating">
                <textarea class="form-control" id="textContent" th:field="*{textContent}" placeholder="글의 내용을 입력하세요"
                          style="height: 500px;resize: none"></textarea>
                <label for="textContent">내용</label>
                <div class="invalid-feedback">
                    3글자 이상 1000 글자 이하여야 한다
                </div>
            </div>
        </div>
    </div>
    <div class="row justify-content-center col">
        <div class="col-6 mb-3 row row-cols-auto justify-content-end">
            <div class="col">
                <button class="btn btn-primary" type="submit" role="button">작성완료</button>
            </div>
        </div>
    </div>
</form>

<footer class="container-fluid mt-auto bg-light py-3">

</footer>
</body>
<script>
    function validationPostingTitle() {
        const postingTitle = document.querySelector("#title");
        if (!postingTitle.checkValidity() || postingTitle.value.length < 1) {
            postingTitle.className = 'form-control is-invalid';
            return false;
        }
        postingTitle.className = 'form-control is-valid';
        return true;
    }

    function validationPostingNickName() {
        const postingNickName = document.querySelector("#nickName");
        if (!postingNickName.checkValidity() || postingNickName.value.length < 1) {
            postingNickName.className = 'form-control is-invalid';
            return false;
        }
        postingNickName.className = 'form-control is-valid';
        return true;
    }

    function validationPostingBody() {
        const postingBody = document.querySelector("#textContent");
        if (!postingBody.checkValidity() || postingBody.value.length < 3 || postingBody.value.length > 1000) {
            postingBody.className = 'form-control is-invalid';
            return false;
        }
        postingBody.className = 'form-control is-valid';
        return true;
    }


    function validationPostingForm(event) {

        let isValidatePostingNickName = validationPostingNickName();
        let isValidatePostingBody = validationPostingBody();
        let isValidatePostingTitle = validationPostingTitle();

        if (!isValidatePostingBody || !isValidatePostingTitle || !isValidatePostingNickName) {
            event.preventDefault();
            event.stopPropagation();
        }
    }

    const form = document.querySelector("#postingForm");
    form.addEventListener('submit', validationPostingForm, false);
</script>

</html>
